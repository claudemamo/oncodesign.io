+++
title = "The Rails Way to Search Filtering"
date = 2013-07-24T12:59:00Z
updated = 2014-01-18T12:16:41Z
tags = ["Ruby on Rails", "search filtering"]
blogimport = true 
[author]
	name = "Claude"
	uri = "https://www.blogger.com/profile/06379003436141860057"
+++

It's been a while since my last post. Numerous changes took place in my professional life since then. I decided to take a break from my career and focus my energy to learning new technologies outside my area of expertise. One biggie is <a href="http://rubyonrails.org/" rel="nofollow" target="_blank">Ruby on Rails</a>&nbsp;3.<br /><br />To test my RoR as well as my UI skills, I created&nbsp;<a href="http://www.evplore.com/" target="_blank">evplore.com</a>: a website for sharing, discovering and creating events. A requirement for evplore is to allow users to filter events by country, locality, tag, or date as shown below:<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="http://2.bp.blogspot.com/-W0wPU-qx8BQ/Ue6pRLSZDoI/AAAAAAAAAF8/hs7qO3SM1Ic/s1600/search-filters.png" imageanchor="1" style="clear: left; float: left; margin-bottom: 1em; margin-right: 1em;"><img border="0" src="http://2.bp.blogspot.com/-W0wPU-qx8BQ/Ue6pRLSZDoI/AAAAAAAAAF8/hs7qO3SM1Ic/s640/search-filters.png" height="436" width="640" /></a></div>Before delving into the nitty-gritty of implementing search filtering, let's have a glance at the <i>EventsController</i>:<br /><br /><script src="https://gist.github.com/claudemamo/6060780.js?file=events_controller.rb"></script>The controller&nbsp;does what you might expect: it invokes the <i>Event</i> model's <i>find</i> method to retrieve the events that match the user's search criteria.<br /><br />Here's a dirty way of implementing the <i>find</i> method inside the <i>Event</i>&nbsp;model:<br /><br /><script src="https://gist.github.com/claudemamo/6060780.js?file=event.rb"></script>Any programmer worth his salt will note that this solution is tough to maintain. The&nbsp;<i>find</i>&nbsp;method has a branch for every possible way the user can apply search filters&nbsp;(in all 2^n branches). Having more than a few filters causes an explosion in the number of&nbsp;<i>elsif</i>&nbsp;branches.<br /><br />The Rails way to solving this problem is to use <b>query chaining</b>&nbsp;along with the <i>scoped</i> method:<br /><br /><script src="https://gist.github.com/claudemamo/6060780.js?file=event(2).rb"></script>The <i>Event</i> model now avoids issuing a different query for each way search filters are applied. Instead, every query corresponding to a filter is put in its own class method. All methods do the same thing more or less. For example, <i>in_country</i> takes as a parameter the country submitted by the user. If the parameter is&nbsp;<i>nil</i>&nbsp;or blank, this means the user did not submit a country filter so the method should skip the query and return the relation as is: this is what the&nbsp;<i>scoped</i>&nbsp;method is for. Otherwise, the filter query is applied on the current relation and the new relation is returned.<br /><br />What's left is for the <i>EventsController </i>to chain together the query methods&nbsp;so that the result of each query is passed on to the next query method for further filtering:<br /><br /><script src="https://gist.github.com/claudemamo/6060780.js?file=events_controller(2).rb"></script>The complete code for this demo is available on <a href="https://github.com/claudemamo/search-filters" target="_blank">GitHub</a>.
