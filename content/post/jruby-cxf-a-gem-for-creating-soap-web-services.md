+++
title = "JRuby CXF: A Gem for Creating SOAP Web Services"
date = 2013-08-10T20:07:00Z
updated = 2014-01-11T12:12:20Z
tags = ["SOAP", "JRuby", "Apache CXF", "Web Services", "Ruby"]
blogimport = true 
[author]
	name = "Claude"
	uri = "https://www.blogger.com/profile/06379003436141860057"
+++

It seems to me that <a href="http://www.w3.org/TR/ws-arch/" target="_blank">Web Services</a> don't receive much love from Rubyists. In fact, of the two Ruby projects I know that add Web Service support (<a href="http://rubygems.org/gems/soap4r" rel="" target="_blank">SOAP4R</a> and <a href="http://rubygems.org/gems/actionwebservice" target="_blank">ActionWebService</a>), both appear to be inactive. Someone might say that if Web Services are a must, then avoid Ruby or put an <a href="http://www.mulesoft.org/" target="_blank">integration layer</a> between your Ruby application and the client/service. From my experience, life is not always that simple and these solutions might not be applicable.&nbsp; <br /><br />The Java ecosystem has a popular and well-supported open source project that is used to build SOAP Web Services and clients. This project is called <a href="http://cxf.apache.org/" target="_blank">Apache CXF</a>. On one fine sunny day I asked myself: "Wouldn't it be great if I could publish a Web Service from Ruby using Apache CXF?". Almost immediately I put that thought away. Trying to integrate a Java library into Ruby is, well, hard in my books. But then&nbsp;<a href="http://jruby.org/" target="_blank">JRuby</a> popped into my mind. JRuby is the Ruby language implemented in Java. This means that Ruby and Java objects talk to each other with relative ease.<br /><br />Seeing the potential in the idea, last week I set about developing a <a href="https://github.com/claudemamo/jruby-cxf" target="_blank">JRuby wrapper gem</a> for CXF. I must admit it was more challenging than I thought but at the end I was happy with the results. The bulk of the work was customising the <a href="http://cxf.apache.org/docs/aegis-21.html" target="_blank">Aegis data binder</a> so that it could map <i><a href="http://jruby.org/apidocs/org/jruby/RubyObject.html" target="_blank">RubyObject</a></i> instances.<br /><br />The first step to using the gem is installing it:<br /><br /><script src="https://gist.github.com/claudemamo/6176537.js?file=install.sh"></script>A <a href="https://github.com/claudemamo/jruby-cxf-example" target="_blank">code example</a> is in order here:<br /><br /><script src="https://gist.github.com/claudemamo/6176537.js?file=example(1).rb"></script>Publishing the above class as a Web Service means requiring the gem and including the module <i>CXF::WebServiceServlet</i>:<br /><br /><script src="https://gist.github.com/claudemamo/6176537.js?file=example(2).rb"></script>Including <i>WebServiceServlet</i> causes the class to become a regular Java servlet. This implies that any servlet container can load the Web Service. For this example, I'll load the Web Service using an embedded Jetty:<br /><br /><script src="https://gist.github.com/claudemamo/6176537.js?file=example(3).rb"></script>Running the example requires two libraries to be available in the Java classpath: <a href="http://archive.apache.org/dist/cxf/2.7.6/" target="_blank">CXF&nbsp;2.7.6</a> and <a href="http://mirror17.pcbsd.org/Mirrors/eclipse/jetty/8.1.12.v20130726/dist/" target="_blank">Jetty&nbsp;8</a>.<br /><br /><script src="https://gist.github.com/claudemamo/6176537.js?file=run-example.sh"></script>Accessing the URL <i>http://localhost:8080/hello-world?wsdl</i> with a browser will display the following WSDL:<br /><br /><script src="https://gist.github.com/claudemamo/6176537.js?file=hello-world(1).wsdl"></script>You'll note that the operations are missing from the WSDL. This is because I didn't tell CXF to expose any of the methods in the class <i>HelloWorld</i> as Web Service operations. Let me do that now:<br /><br /><script src="https://gist.github.com/claudemamo/6176537.js?file=example(4).rb"></script><i>expose</i>&nbsp;tells CXF to publish the method denoted by the first argument (i.e., <i>:say_hello</i>). The second argument in <i>expose</i> is a map. It should have at a&nbsp;<b>minimum</b> the following entries:<br /><ol><li>&nbsp;<i>expects</i>&nbsp;- maps to an ordered list of hashes where each hash corresponds to a method parameter and its expected type.</li><br /><li>&nbsp;<i>returns</i>&nbsp;- maps to the expected return type (e.g., <i>:string</i>).</li></ol>Re-executing the example will give out this WSDL:<br /><br /><script src="https://gist.github.com/claudemamo/6176537.js?file=hello-world(2).wsdl"></script>The gem supports various options to customise the WSDL. For instance, the service name and namespace can be changed:<br /><br /><script src="https://gist.github.com/claudemamo/6176537.js?file=example(5).rb"></script>The complete list of options is found in the project repository's&nbsp;<i><a href="https://github.com/claudemamo/jruby-cxf/blob/master/README.md" target="_blank">README</a></i>&nbsp;file&nbsp;.<br /><br />Till now I've assumed that a Web Service operation will only accept simple types. In the real world we're more likely to be using complex types:<br /><br /><script src="https://gist.github.com/claudemamo/6176537.js?file=example(6).rb"></script>I've added two classes in the example: <i>Animal</i> and <i>Person</i>.&nbsp;It is necessary to include the <i>CXF::ComplexType</i> module so that CXF can derive an XML schema from these classes and embed the schema in the WSDL. A complex type element is declared using the method <i>member</i>. A&nbsp;<i>member</i>&nbsp;needs at least a name for the element and its type. You could also declare whether a property is required as seen in the member <i>pet</i>. The <i>required</i> option defaults to true if not specified.<br /><br />Note that now <i>say_hello</i>&nbsp;and&nbsp;<i>give_age </i>are&nbsp;expecting a&nbsp;<i>Person</i>&nbsp;object instead of primitive types and they are accessing the object via accessors. Behind the scenes the gem creates an accessor for each member that is declared.<br /><br />I hope I've given you enough info to get started out with the gem. My plan is maintain JRuby CXF as I believe it could be useful for those who aren't happy with the current alternatives. Of course, if you find an issue with the gem, I'd be more than happy to accept code contributions ;-).
