+++
title = "Bridging Mule and MSMQ with ZeroMQ"
date = 2013-08-27T17:36:00Z
updated = 2014-01-10T22:25:14Z
tags = ["Mule ZeroMQ Transport", "MSMQ", "C#", "Mule", "ZeroMQ", "ZMQ"]
blogimport = true 
[author]
	name = "Claude"
	uri = "https://www.blogger.com/profile/06379003436141860057"
+++

Hearing the words Mule and Microsoft's MSMQ in the same sentence sends a shiver down my spine. I remember once, Mule guru <a href="http://blogs.mulesoft.org/author/john-demic/" target="_blank">John D'Emic</a> and me had spent a considerable amount of time and patience getting Mule and MSMQ to talk to each other through DCOM. The major factor that contributed to this unpleasant experience was our ignorance of the numerous security measures imposed by Windows to restrict DCOM access. The morale of this story is unless you have a veteran Windows administrator at your disposal, avoid the DCOM route.<br /><br />So which choices do we have other than DCOM? JNI sounds promising but you are then sacrificing Mule's platform independence. Here's an idea: introduce a <a href="http://www.eaipatterns.com/MessagingBridge.html" target="_blank">messaging bridge</a> between Mule and MSMQ. The bridge can be implemented in any language that facilitates interaction with MSMQ. C# is an attractive option.<br /><br />We still have to consider which middleware to use for exchanging messages between the bridge and Mule. There are many alternatives and among them is <a href="http://zeromq.org/" target="_blank">ZeroMQ</a>. I think ZeroMQ is a good candidate for several reasons:<br /><ul><li>It supports asynchronous communication</li><li>You're not adding another component to your architecture</li><li>It's well documented in addition to having a low learning curve</li><li>A ZeroMQ&nbsp;<a href="https://github.com/claudemamo/mule-transport-zeromq" target="_blank">transport</a> [1] and <a href="https://github.com/zeromq/clrzmq" target="_blank">binding</a>&nbsp;are available for Mule and C# respectively</li><li>It will more than likely satisfy your message throughput requirements</li></ul>In as little as 15 minutes I developed a simple bridge in C#:<br /><br /><script src="https://gist.github.com/claudemamo/6345631.js?file=bridge.cs"></script> The above code should be self-explanatory but I've put comments for your convenience.<br /><br />Here's the Mule 3 app dispatching messages to the bridge:<br /><br /><script src="https://gist.github.com/claudemamo/6345631.js?file=mule-config.xml"></script>On receiving an HTTP request, Mule leverages the ZeroMQ transport to send asynchronously the request's payload to the bridge.<br /><br />In all likelihood, the illustrated bridge code for Mule-MSMQ interoperability won't serve all your needs. I can think about a dozen features that a developer would want such as destination queues resolved at run-time, an agreed format for message content, and etc. But hey, at least it's a start :-)<br /><br /><div style="text-align: justify;"><span style="font-family: Times, Times New Roman, serif; font-size: small;"><span class="num">1:&nbsp;</span></span><span style="font-family: Times, Times New Roman, serif;">I've recently replaced the transport's ZeroMQ C++ library with a <a href="https://github.com/zeromq/jeromq" target="_blank">pure Java implementation</a> of ZeroMQ.</span></div>
